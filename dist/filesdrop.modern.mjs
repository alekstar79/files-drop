function t(t,e,i){const s=Array.from(t);let n;if(""===e)return n=s.filter(t=>"file"===t.kind),i?n:[n[0]];const r=e.toLowerCase().split(",").map(t=>t.split("/").map(t=>t.trim())).filter(t=>2===t.length);return n=s.filter(t=>{if("file"!==t.kind)return!1;const[e,i]=t.type.toLowerCase().split("/").map(t=>t.trim());for(const[t,s]of r)if(e===t&&("*"===s||i===s))return!0;return!1}),i||(n=[n[0]]),n}function e(e,i,s){const n=t(e.items,i,s),r=[];return n.forEach(t=>{const e=t.getAsFile();null!==e&&r.push(e)}),r}class i extends Event{constructor(t,e){var s;super(t,e),this._action=void 0,this._files=void 0,this instanceof(s=i)||Object.setPrototypeOf(this,s.prototype),this._action=e.action,this._files=e.files}get action(){return this._action}get files(){return this._files}}class s extends HTMLElement{static register(t="file-drop"){"customElements"in window&&customElements.define(t,this)}constructor(){super(),this._dragEnterCount=0,this._onDragEnter=this._onDragEnter.bind(this),this._onDragLeave=this._onDragLeave.bind(this),this._onDrop=this._onDrop.bind(this),this._onPaste=this._onPaste.bind(this),this._onClick=this._onClick.bind(this)}get accept(){return this.getAttribute("accept")||""}set accept(t){this.setAttribute("accept",t)}get multiple(){return this.hasAttribute("multiple")}get clickable(){return this.hasAttribute("clickable")}connectedCallback(){this.addEventListener("dragover",t=>t.preventDefault()),this.addEventListener("drop",this._onDrop),this.addEventListener("dragenter",this._onDragEnter),this.addEventListener("dragend",()=>this._reset()),this.addEventListener("dragleave",this._onDragLeave),this.addEventListener("paste",this._onPaste),this.clickable&&this.addEventListener("click",this._onClick)}disconnectedCallback(){this.removeEventListener("dragover",t=>t.preventDefault()),this.removeEventListener("drop",this._onDrop),this.removeEventListener("dragenter",this._onDragEnter),this.removeEventListener("dragend",()=>this._reset()),this.removeEventListener("dragleave",this._onDragLeave),this.removeEventListener("paste",this._onPaste),this.clickable&&this.removeEventListener("click",this._onClick)}_onDragEnter(e){if(this._dragEnterCount+=1,this._dragEnterCount>1)return;if(null===e.dataTransfer)return void this.classList.add("drop-invalid");const i=t(e.dataTransfer.items,this.accept,this.multiple);this.classList.add(e.dataTransfer&&e.dataTransfer.items.length&&void 0===i[0]?"drop-invalid":"drop-valid")}_onDragLeave(){this._dragEnterCount-=1,0===this._dragEnterCount&&this._reset()}_onDrop(t){if(t.preventDefault(),null===t.dataTransfer)return;this._reset();const s=e(t.dataTransfer,this.accept,this.multiple);void 0!==s&&this.dispatchEvent(new i("filedrop",{action:"drop",files:s}))}_onPaste(t){if(!t.clipboardData)return;const s=e(t.clipboardData,this.accept,this.multiple);void 0!==s&&this.dispatchEvent(new i("filedrop",{action:"paste",files:s}))}_reset(){this._dragEnterCount=0,this.classList.remove("drop-valid"),this.classList.remove("drop-invalid")}_onClick(){return new Promise(()=>{const t=document.createElement("input"),e=new MouseEvent("click",{cancelable:!0,bubbles:!0,view:window});t.multiple=this.multiple,t.accept=this.accept,t.type="file",Object.assign(t.style,{visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px"}),t.addEventListener("change",e=>{var s;const n=e.target,r=this.accept.split("/")[0],a=Array.from(n.files).filter(t=>t.type.split("/")[0]===r);this.dispatchEvent(new i("filedrop",{action:"click",files:a})),null==(s=t.parentNode)||s.removeChild(t)}),document.body.appendChild(t),t.dispatchEvent(e)})}}s.register();export{i as FileDropEvent,s as FilesDropElement};
//# sourceMappingURL=filesdrop.modern.mjs.map
